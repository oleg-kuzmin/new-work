# [`FSD`](./index.md)

## Layers (Слои)

Существует 6 слоев.

Импортировать можно только из нижестоящего слоя. Например в `shared` нельзя импортировать из `features`.

Каждый слой содержит подкаталоги `Slice (Срезы)`.

### 1. `app`

всё, благодаря чему приложение запускается — роутинг, точки входа, глобальные стили, провайдеры для всего приложения и т. д.

`App` и `Shared`, в отличие от других слоев, не имеют слайсов и состоят из сегментов напрямую.

### 2. `pages`

Полные страницы или большие части страницы при вложенном роутинге. Композиционный слой для сборки полноценных страниц из сущностей, фич и виджетов.

### 3. `widgets`

Композиционный слой для соединения сущностей и фич в самостоятельные блоки (например, IssuesList, UserProfile). Также в виджеты можно выделять компоненты+логику, которые характерны для данного продукта, пускай даже без бизнес составляющей. Например, ThemeProvider+ThemeStore (тема сайта). Конечно, такой код можно поместить в shared, однако в то же время тема является чем-то уникальным для проекта, поэтому ее можно расположить на слое виджетов.

### 4. `features`

Взаимодействия с пользователем, действия, которые несут бизнес-ценность для пользователя (например, SendComment, AddToCart, UsersSearch). Фичи взаимодействуют с сущностями: изменяют, отправляют, удаляют и подобное. Все действия над сущностью выделяются в фичи.

### 5. `entities`

Бизнес-сущности, с которыми работает проект (например, User, Product, Order), они же бизнес-обьекты, присущие данному бизнесу.

### 6. `shared`

Переиспользуемый код, не имеющий отношения к специфике приложения/бизнеса, хотя это не обязательно (например, UIKit, libs, API). Этот код можно спокойно переносить с проекта на проект. Если при создании функции/компонента ты понимаешь, что это можно использовать для сайта интернет магазина и онлайн бухгалтерии, то, пожалуй, это shared.

`App` и `Shared`, в отличие от других слоев, не имеют слайсов и состоят из сегментов напрямую.

## Slices (Срезы)

Дальше идут слайсы, они делят слой по предметной области. Вы можете называть ваши слайсы как угодно, и создавать их сколько угодно. Слайсы помогают не теряться в проекте, потому что группируют тесно связанный по смыслу код.

Слайсы не могут использовать другие слайсы на том же слое, и это обеспечивает сильную связанность кода внутри слайса и слабую сцепленность между слайсами.

Слайсы должны содержать публичный интерфейс, точку входа `index.ts` для реэкспорта.

Подкаталоги `Slice (Срезы)` состоят из `Segments (Сегменты)`.

## Segments (Сегменты)

Слайсы, а также слои `App` и `Shared`, состоят из сегментов, а сегменты группируют код по его назначению. Имена сегментов не зафиксированы стандартом, но существует несколько общепринятых имен для наиболее распространенных целей:

- `ui` — всё, что связано с отображением: UI-компоненты, форматтеры дат, стили и т.д.
- `api` — взаимодействие с бэкендом: функции запросов, типы данных, мапперы.
- `model` — модель данных: схемы валидации, интерфейсы, хранилища и бизнес-логика.
- `lib` — библиотечный код, который нужен другим модулям этого слайса.
- `config` — файлы конфигурации и фиче-флаги.

Обычно этих сегментов достаточно для большинства слоев, поэтому свои собственные сегменты обычно создают только в Shared или App, но это не жёсткое правило.

## Правила

| Слои     |             Можно использовать             |           Нельзя использовать           |
| :------- | :----------------------------------------: | :-------------------------------------: |
| app      | shared, entities, features, widgets, pages |                    -                    |
| pages    |    shared, entities, features, widgets     |                   app                   |
| widgets  |         shared, entities, features         |               pages, app                |
| features |              shared, entities              |           widgets, pages, app           |
| entities |                   shared                   |      features, widgets, pages, app      |
| shared   |                     -                      | entities, features, widgets, pages, app |

## Как определить куда класть

Небольшой лайфхак для разработки - если нет уверенности, куда поместить конкретную часть проекта, то начинаем с верхнего слоя (`widgets`).

1. Положим компонент в `widgets`. Почему не выше по слоям? `pages` и `app` определить не так сложно, проблемы возникают ниже.
2. Нам нужно использовать этот `widget` в других `widgets`? Если да, читаем дальше.
3. Кладем компонент в `features`.
4. Нам нужно использовать эту `feature` в других `features`? Если да, опускаем еще ниже - `entities`.
5. По аналогии с 2-4 пунктами проверяем, если опять находим пересечением на одном уровне, то кидаем в `shared` и не беспокоимся.

## Пример

```bash
/src
  /app
  /pages
    /catalog
  /widgets
  /features
    /add-to-cart
    /add-to-favorite
      /ui
      /model
      /lib
  /enitities
    /cart
    /product
  /shared
    /api
    /ui
    /lib
```
