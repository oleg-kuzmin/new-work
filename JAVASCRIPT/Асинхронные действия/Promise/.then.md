# [`.then()`](../../index.md)

Метод `then()` используют, чтобы выполнить код после изменения состояния промиса.

Вокруг функции промиса и обработчиков находится "невидимый `try..catch`".

Это работает не только в функции промиса, но и в обработчиках. Если мы бросим ошибку `throw` из обработчика `.then()`, то промис будет считаться отклонённым, и управление перейдёт к ближайшему обработчику ошибок.

## Синтаксис

```js
promise.then(
  function onFulfill(value) {
    // обработает успешное выполнение
  },
  function onReject(error) {
    // обработает ошибку
  }
);
```

### `onFulfill`

Функция-колбэк, которая будет вызвана при переходе промиса в состояние «успех» `fulfilled`. Функция имеет один параметр `value`, в который передаётся результат выполнения операции.

### `value`

Значение, которое будет передано в `resolve(value)` и записано как результат промиса.

### `onReject` / обычно не используется

Функция-колбэк, которая будет вызвана при переходе промиса в состояние «ошибка» `rejected`. Функция имеет один параметр `error`, в который передаётся информация об ошибке. Второй аргумент в индустрии обычно не используется.

## Возвращает

### `object promise`

`.state` - `rejected`

`.result` - `value`

Возвращает новый объект `Promise`. Возвращаемое `then()` значение `value` также передаётся дальше в следующий обработчик `then()`.

## Пример

_Пример с двумя аргументами_

```js
// getPasswords() — асинхронная функция, которая возвращает промис
getPasswords().then(
  function (result) {
    // что-то делаем с результатом операции
    console.log('Все пароли:' + result);
  },
  function (err) {
    // обрабатываем ошибку
    console.error(err.message);
  }
);
```

_Последовательность асинхронных операций_

```js
// запросим через API список домов из Игры престолов. Метод `fetch` возвращает промис
fetch('https://www.anapioficeandfire.com/api/houses')
  .then(function (response) {
    // выполнится, когда от API придет ответ
    // запустим асинхронную операцию парсинга JSON из ответа сервера
    return response.json(); // вернем из обработчика промис, к которому добавим then
  })
  .then(function (houses) {
    // выполнится, когда JSON распарсится
    return fetch(houses[0].overlord); // запросим данные о сюзерене этого дома
  })
  .then(function (response) {
    // выполнится, когда от API придет ответ
    return response.json();
  })
  .then(function (overlord) {
    console.log(overlord.name);
  });
```
